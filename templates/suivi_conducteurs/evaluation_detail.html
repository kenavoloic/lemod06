<!-- templates/suivi_conducteurs/evaluation_detail.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation - {{ evaluation.conducteur.nom_complet }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .score-badge {
            font-size: 1.2rem;
            padding: 0.5rem 1rem;
        }
        .score-excellent { background-color: #28a745; }
        .score-good { background-color: #17a2b8; }
        .score-average { background-color: #ffc107; color: #212529; }
        .score-poor { background-color: #dc3545; }
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .criteria-card {
            text-align: center;
            padding: 1rem;
            border-radius: 0.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        .criteria-score {
            font-size: 2rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        .print-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
        }
        @media print {
            .no-print { display: none !important; }
            .print-btn { display: none !important; }
        }
    </style>
</head>
<body>
		{% include 'includes/navbar.html' %}
  <div class="container mt-4 position-relative">
        <!-- Bouton d'impression -->
        <button onclick="window.print()" class="btn btn-outline-secondary print-btn no-print">
            <i class="fas fa-print"></i> Imprimer
        </button>

        <!-- En-tête -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-6 mb-3">
                    <i class="fas fa-clipboard-check text-primary"></i>
                    Évaluation {{ evaluation.type_evaluation.nom }}
                </h1>
            </div>
        </div>

        <!-- Informations principales -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-info-circle"></i>
                            Informations de l'évaluation
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Conducteur :</strong><br>
                                   <i class="fas fa-user"></i> {{ evaluation.conducteur.nom_complet }}</p>
                                <p><strong>Société :</strong><br>
                                   <i class="fas fa-building"></i> {{ evaluation.conducteur.salsocid.socnom }}</p>
                                <p><strong>Site :</strong><br>
                                   <i class="fas fa-map-marker-alt"></i> {{ evaluation.conducteur.site.nom_commune }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Évaluateur :</strong><br>
                                   <i class="fas fa-user-tie"></i> {{ evaluation.evaluateur.nom_complet }}</p>
                                <p><strong>Service :</strong><br>
                                   <i class="fas fa-users"></i> {{ evaluation.evaluateur.service.nom }}</p>
                                <p><strong>Date :</strong><br>
                                   <i class="fas fa-calendar"></i> {{ evaluation.date_evaluation|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                        <hr>
                        <p class="mb-0"><strong>Description :</strong><br>
                           {{ evaluation.type_evaluation.description }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Statistiques -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-line"></i>
                            Résultats
                        </h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <span class="badge score-badge {% if stats.moyenne >= 8 %}score-excellent{% elif stats.moyenne >= 6 %}score-good{% elif stats.moyenne >= 4 %}score-average{% else %}score-poor{% endif %}">
                                {{ stats.moyenne|floatformat:1 }}/10
                            </span>
                        </div>
                        <p class="mb-2"><strong>Moyenne générale</strong></p>
                        <hr>
                        <div class="row text-center">
                            <div class="col-6">
                                <h5 class="text-primary">{{ stats.notes_attribuees }}</h5>
                                <small class="text-muted">Notes données</small>
                            </div>
                            <div class="col-6">
                                <h5 class="text-info">{{ stats.total_criteres }}</h5>
                                <small class="text-muted">Critères total</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Détail des notes -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-star"></i>
                            Détail des notes par critère
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="criteria-grid">
                            {% for note in notes %}
                                <div class="criteria-card">
                                    <h3 class="criteria-score 
                                        {% if note.valeur >= 8 %}text-success
                                        {% elif note.valeur >= 6 %}text-info
                                        {% elif note.valeur >= 4 %}text-warning
                                        {% else %}text-danger{% endif %}">
                                        Critère {{ note.critere.nom }}
                                    </h3>
                                    <div class="criteria-score 
                                        {% if note.valeur >= 8 %}text-success
                                        {% elif note.valeur >= 6 %}text-info
                                        {% elif note.valeur >= 4 %}text-warning
                                        {% else %}text-danger{% endif %}">
                                        {% if note.valeur %}
                                            {{ note.valeur }}/{{ note.critere.valeur_maxi }}
                                        {% else %}
                                            Non noté
                                        {% endif %}
                                    </div>
                                    <small class="text-muted">
                                        Échelle: {{ note.critere.valeur_mini }}-{{ note.critere.valeur_maxi }}
                                    </small>
                                </div>
                            {% empty %}
                                <div class="col-12">
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Aucune note enregistrée pour cette évaluation.
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="row mt-4 no-print">
            <div class="col-12">
                <div class="d-flex justify-content-between">
                    <a href="{% url 'suivi_conducteurs:evaluation_list' %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Retour à la liste
                    </a>
                    <div>
                        <a href="{% url 'suivi_conducteurs:create_evaluation' %}" class="btn btn-success">
                            <i class="fas fa-plus"></i> Nouvelle évaluation
                        </a>
                        <button onclick="window.print()" class="btn btn-outline-primary">
                            <i class="fas fa-print"></i> Imprimer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer pour l'impression -->
        <div class="row mt-5 d-none d-print-block">
            <div class="col-12 text-center">
                <hr>
                <small class="text-muted">
                    Évaluation générée le {{ "now"|date:"d/m/Y à H:i" }} - 
                    Système de suivi des conducteurs
                </small>
            </div>
        </div>
    </div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	</body>
	
	</html>
